<!DOCTYPE html>
<html lang="zh-TW">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>科技喵 - 專用掃碼器</title>
<link href="https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@400;700&display=swap" rel="stylesheet">
<script src="https://cdn.jsdelivr.net/npm/html5-qrcode@2.3.10/minified/html5-qrcode.min.js"></script>
<style>
body { font-family:'Noto Sans TC',sans-serif; background:#0d0d23; color:white; display:flex; flex-direction:column; align-items:center; justify-content:center; height:100vh; margin:0; overflow:hidden;}
.scanner-box { position:relative; background: rgba(255,255,255,0.08); border-radius:20px; padding:20px; width:340px; box-shadow:0 0 40px rgba(0,255,255,0.2); text-align:center;}
h1{text-shadow:0 0 15px cyan;margin-bottom:10px;}
#reader{width:300px;height:300px;margin:0 auto;border-radius:15px;overflow:hidden;}
.laser{position:absolute;top:0;left:0;width:100%;height:3px;background:linear-gradient(90deg,transparent,cyan,transparent);animation:scan 2s infinite linear;}
@keyframes scan{0%{top:0}50%{top:calc(100%-3px)}100%{top:0}}
</style>
</head>
<body>

<div class="scanner-box">
  <h1>🚀 科技喵 - 專用掃碼器</h1>
  <p>將 QR 對準鏡頭掃描</p>
  <div id="reader"></div>
  <div class="laser"></div>
</div>

<script>
const SECRET_SIG="|sig=TechMeowSpecial";

function decrypt(encoded){
  try{
    const reversed=encoded.split("").reverse().join("");
    const decoded=decodeURIComponent(escape(atob(reversed)));
    if(!decoded.includes(SECRET_SIG)) return null;
    return decoded.replace(SECRET_SIG,"");
  }catch{return null;}
}

function startScanner(){
  const html5QrCode = new Html5Qrcode("reader");
  html5QrCode.start(
    { facingMode: "environment" },
    { fps: 10, qrbox: 250 },
    qrCodeMessage=>{
      if(qrCodeMessage.includes("/index.html#")){
        const encoded=qrCodeMessage.split("#")[1];
        const link=decrypt(encoded);
        if(link){
          html5QrCode.stop().then(()=>{
            alert("✅ 驗證成功，開啟專屬頁面");
            location.href=link;
          });
        } else alert("⚠️ 非授權 QR Code");
      } else alert("❌ 非本系統 QR Code");
    },
    errorMessage=>{
      // 可忽略掃描過程錯誤
    }
  ).catch(err=>{
    alert("❌ 無法啟動相機: "+err);
  });
}

// 啟動掃描器
window.onload=startScanner;
</script>

</body>
</html>
