<!DOCTYPE html>
<html lang="zh-TW">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ç§‘æŠ€å–µ - å°ˆç”¨QRç”Ÿæˆå™¨</title>
<link href="https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@400;700&display=swap" rel="stylesheet">
<script src="https://cdn.jsdelivr.net/npm/qrcode@1.5.1/build/qrcode.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/html5-qrcode@2.3.10/minified/html5-qrcode.min.js"></script>
<style>
body {
  font-family: 'Noto Sans TC', sans-serif;
  background: radial-gradient(circle at 20% 20%, #3a3a9f, #0d0d23);
  color: white;
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  min-height: 100vh;
  margin: 0;
}
.glass-box {
  background: rgba(255,255,255,0.08);
  backdrop-filter: blur(15px);
  border-radius: 20px;
  padding: 40px;
  text-align: center;
  box-shadow: 0 0 40px rgba(0,255,255,0.2);
  width: 360px;
  margin-bottom: 20px;
}
input, button {
  width: 100%;
  padding: 10px;
  margin: 10px 0;
  border-radius: 10px;
  border: none;
  font-size: 1rem;
}
input {
  background: rgba(255,255,255,0.15);
  color: white;
  text-align: center;
}
input::placeholder { color: rgba(255,255,255,0.6);}
button {
  background: linear-gradient(90deg,#007bff,#8a2be2);
  color: white;
  cursor: pointer;
  transition: 0.3s;
}
button:hover { box-shadow:0 0 15px #00ffff; transform:scale(1.05);}
#qrcode { margin-top: 20px; }
#preview { width: 300px; height: 300px; margin-top:20px; border-radius:15px; overflow:hidden; position:relative;}
.laser { position:absolute; top:0; left:0; width:100%; height:3px; background: linear-gradient(90deg, transparent, cyan, transparent); animation: scan 2s infinite linear; }
@keyframes scan {0%{top:0}50%{top:calc(100%-3px)}100%{top:0}}
</style>
</head>
<body>

<div class="glass-box" id="loginBox">
  <h2>ğŸ” ç§‘æŠ€å–µç®¡ç†å“¡ç™»å…¥</h2>
  <input type="password" id="pwd" placeholder="è¼¸å…¥å¯†ç¢¼">
  <button onclick="checkPwd()">ç™»å…¥</button>
</div>

<div class="glass-box" id="mainBox" style="display:none;">
  <h2>ğŸ§¬ ç”Ÿæˆå°ˆç”¨ QR Code</h2>
  <input type="text" id="url" placeholder="è¼¸å…¥ç¶²å€">
  <button onclick="generate()">ç”Ÿæˆ QR</button>
  <div id="qrcode"></div>
  <button onclick="downloadQR()">â¬‡ï¸ ä¸‹è¼‰ PNG</button>
  <div id="preview">
    <div class="laser"></div>
  </div>
</div>

<script>
const SECRET_SIG="|sig=TechMeowSpecial";

function checkPwd(){
  if(document.getElementById('pwd').value==="0710"){
    loginBox.style.display="none";
    mainBox.style.display="block";
    startPreviewScan();
  } else alert("å¯†ç¢¼éŒ¯èª¤ï¼");
}

function encrypt(url){
  const text = url + SECRET_SIG;
  return btoa(unescape(encodeURIComponent(text))).split("").reverse().join("");
}

function generate(){
  const url = document.getElementById('url').value.trim();
  if(!url) return alert("è«‹è¼¸å…¥ç¶²å€ï¼");
  const final = location.origin+"/scan.html#"+encrypt(url);
  const qrcodeContainer = document.getElementById("qrcode");
  qrcodeContainer.innerHTML = "";

  QRCode.toCanvas(final, { 
    width: 220, 
    color: { dark:"#000000", light:"#ffffff" }, 
    errorCorrectionLevel: 'H' 
  }, function (err, canvas) {
    if(err) console.error(err);
    const ctx = canvas.getContext('2d');
    const imgData = ctx.getImageData(0,0,canvas.width,canvas.height);
    const data = imgData.data;
    const r = 3;
    ctx.clearRect(0,0,canvas.width,canvas.height);
    for(let y=0;y<canvas.height;y+=r*2){
      for(let x=0;x<canvas.width;x+=r*2){
        const i=(y*canvas.width+x)*4;
        if(data[i]<128){
          ctx.beginPath();
          ctx.arc(x+r,y+r,r,0,2*Math.PI);
          ctx.fillStyle="#000";
          ctx.fill();
        }
      }
    }
    qrcodeContainer.appendChild(canvas);
  });
}

function downloadQR(){
  const canvas = document.querySelector("#qrcode canvas");
  if(!canvas) return alert("è«‹å…ˆç”Ÿæˆ QR Codeï¼");
  const link = document.createElement('a');
  link.download = "TechMeow_QR.png";
  link.href = canvas.toDataURL("image/png");
  link.click();
}

// å³æ™‚æƒæé è¦½ï¼ˆä¸é–‹å•Ÿç¶²é ï¼Œåªç¤ºæ„é›·å°„å‹•ç•«ï¼‰
function startPreviewScan(){
  const preview = document.getElementById("preview");
  // å¯ä»¥åœ¨æ­¤åŠ å¯¦æ™‚æƒæé è¦½æˆ–é›·å°„å‹•ç•«
}
</script>

</body>
</html>
